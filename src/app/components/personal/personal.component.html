<div class="container">
  <div class="card">
    <h2>Lista de Personal</h2>
    <div class="button-container">
      <button mat-raised-button color="primary" (click)="openRegisterForm()">
        Nuevo Personal
      </button>
    </div>

    <div *ngIf="showRegisterForm" class="register-form-overlay">
      <div class="register-form-container">
        <h2>{{ editMode ? "Editar" : "Registrar" }} Personal</h2>
        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
          <div class="form-grid">
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Nombres</mat-label>
                <input matInput formControlName="nombres" required />
              </mat-form-field>
            </div>
            <div></div>
            <!-- Central gap -->
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Apellidos</mat-label>
                <input matInput formControlName="apellidos" required />
              </mat-form-field>
            </div>
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Dirección</mat-label>
                <input matInput formControlName="direccion" required />
              </mat-form-field>
            </div>
            <div></div>
            <!-- Central gap -->
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Género</mat-label>
                <mat-select formControlName="genero" required>
                  <mat-option
                    *ngFor="let genero of generos"
                    [value]="genero.value"
                  >
                    {{ genero.viewValue }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Teléfono</mat-label>
                <input matInput formControlName="telefono" required />
              </mat-form-field>
            </div>
            <div></div>
            <!-- Central gap -->
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Email</mat-label>
                <input matInput formControlName="email" required />
              </mat-form-field>
            </div>
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Contraseña</mat-label>
                <input
                  matInput
                  type="password"
                  formControlName="password"
                  required
                />
              </mat-form-field>
            </div>
            <div></div>
            <!-- Central gap -->
            <div class="form-grid-item">
              <mat-form-field appearance="fill">
                <mat-label>Rol</mat-label>
                <mat-select formControlName="id_rol" required>
                  <mat-option *ngFor="let role of roles" [value]="role.id">
                    {{ role.nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="form-actions">
            <button
              mat-button
              type="button"
              class="cancel"
              (click)="closeRegisterForm()"
            >
              Cancelar
            </button>
            <button mat-button type="submit" color="primary">
              {{ editMode ? "Actualizar" : "Registrar" }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="table-container">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
        <ng-container matColumnDef="nombres">
          <th mat-header-cell *matHeaderCellDef>Nombre</th>
          <td mat-cell *matCellDef="let usuario">{{ usuario.nombres }}</td>
        </ng-container>

        <ng-container matColumnDef="apellidos">
          <th mat-header-cell *matHeaderCellDef>Apellidos</th>
          <td mat-cell *matCellDef="let usuario">{{ usuario.apellidos }}</td>
        </ng-container>

        <ng-container matColumnDef="direccion">
          <th mat-header-cell *matHeaderCellDef>Dirección</th>
          <td mat-cell *matCellDef="let usuario">{{ usuario.direccion }}</td>
        </ng-container>

        <ng-container matColumnDef="telefono">
          <th mat-header-cell *matHeaderCellDef>Teléfono</th>
          <td mat-cell *matCellDef="let usuario">{{ usuario.telefono }}</td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let usuario">{{ usuario.email }}</td>
        </ng-container>

        <ng-container matColumnDef="id_rol.nombre">
          <th mat-header-cell *matHeaderCellDef>Rol</th>
          <td mat-cell *matCellDef="let usuario">
            {{ usuario.id_rol.nombre }}
          </td>
        </ng-container>

        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let usuario">
            <button
              mat-icon-button
              color="primary"
              (click)="editUsuario(usuario)"
            >
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              color="warn"
              (click)="deleteUsuario(usuario)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <div *ngIf="dataSource.data.length === 0" class="empty-state">
        No hay personal disponible.
      </div>
    </div>
  </div>
</div>
